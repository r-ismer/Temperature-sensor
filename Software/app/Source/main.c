// **********************************************************************************************************
// File name     : main.c                                                                                   * 
// Author        : Richard I.                                                                               *
// Date          : 30/01/2026                                                                               *
// Description   : Main file                                                                                *
// **********************************************************************************************************
// **********************************************************************************************************
//                                               Include                                                    *
// **********************************************************************************************************
#include "main.h"
#include "task.h"

// **********************************************************************************************************
//                                               Defines                                                    *
// **********************************************************************************************************

// **********************************************************************************************************
//                                              Variables                                                   *
// **********************************************************************************************************

// **********************************************************************************************************
//                                       Private prototype functions                                        *
// **********************************************************************************************************
// **********************************************************************************************************
//                                            Public fuctions                                               *
// **********************************************************************************************************
// **********************************************************************************************************
// Function name    : main                                                                                  *
// Description      : Main function.                                                                        *
// **********************************************************************************************************
int main(void)
{
    // Initialize the HAL library
    HAL_Init();

    // Configure the hardware
    hw_config();

    // Initialize the task
    task_init();

    // Start the timer
    HAL_TIM_Base_Start_IT(&ge_hw_tim_handle);

    // Main loop
    while (1)
    {
        // Disable SysTick
        HAL_SuspendTick();

        // Sleep
        HAL_PWR_EnterSLEEPMode(PWR_MAINREGULATOR_ON, PWR_SLEEPENTRY_WFI);

        // The timer has times out and we can now run the task
        task();
    }
}

// **********************************************************************************************************
// Function name    : error_handler                                                                         *
// Description      : Error handler function.                                                               *
// **********************************************************************************************************
void error_handler(void)
{
    // Infinite loop
    while (1)
    {
        // Break here for debugger
        __asm("bkpt");
    }
}

// **********************************************************************************************************
// Function name    : assert_failed                                                                         *
// Description      : Assert failed function.                                                               *
// **********************************************************************************************************
void assert_failed(uint8_t* file, uint32_t line)
{
    // Infinite loop
    while (1)
    {
        // Break here for debugger
        __asm("bkpt");
    }
}
